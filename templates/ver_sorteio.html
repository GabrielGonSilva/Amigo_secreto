{% extends "base.html" %}

{% block title %}Meu Amigo Secreto - {{ grupo.nome }}{% endblock %}

{% block content %}
<div class="meu-sorteio-container">
    <div class="meu-sorteio-header">
        <h1><i class="fas fa-user-secret"></i> Meu Amigo Secreto</h1>
        <p class="subtitle">Grupo: {{ grupo.nome }}</p>
        <div class="header-actions">
            <a href="{{ url_for('ver_grupo', grupo_id=grupo.id) }}" class="btn btn-secondary">
                <i class="fas fa-users"></i> Voltar ao Grupo
            </a>
            <a href="{{ url_for('lista_sugestoes', grupo_id=grupo.id) }}" class="btn btn-primary">
                <i class="fas fa-gifts"></i> Ver Sugest√µes
            </a>
        </div>
    </div>

    <div class="card sorteio-info">
        <div class="info-header">
            <h2><i class="fas fa-info-circle"></i> Informa√ß√µes do Sorteio</h2>
            <span class="badge-visualizacoes">
                <i class="fas fa-eye"></i> Visualizado {{ sorteio.vezes_visualizado }} vezes
            </span>
        </div>

        <div class="info-content">
            <div class="info-item">
                <i class="fas fa-calendar"></i>
                <div>
                    <strong>Data do Sorteio</strong>
                    <p>{{ sorteio.data_sorteio.strftime('%d/%m/%Y √†s %H:%M') }}</p>
                </div>
            </div>

            <div class="info-item">
                <i class="fas fa-history"></i>
                <div>
                    <strong>√öltima Visualiza√ß√£o</strong>
                    <p>
                        {% if sorteio.ultima_visualizacao %}
                            {{ sorteio.ultima_visualizacao.strftime('%d/%m/%Y √†s %H:%M') }}
                        {% else %}
                            Agora
                        {% endif %}
                    </p>
                </div>
            </div>

            <div class="info-item">
                <i class="fas fa-link"></i>
                <div>
                    <strong>Link Permanente</strong>
                    <div class="link-container">
                        <input type="text" value="{{ request.url }}" readonly id="linkPerm">
                        <button onclick="copiarLink()" class="btn-copiar" title="Copiar link">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <small class="form-text">Guarde este link para acessar novamente</small>
                </div>
            </div>
        </div>
    </div>

    <div class="card amigo-revelado">
        <div class="revelacao-header">
            <h2><i class="fas fa-gift"></i> üéâ Seu Amigo Secreto √© üéâ</h2>
        </div>

        <div class="amigo-detalhes">
            <div class="amigo-avatar-grande">{{ amigo.nome[0]|upper }}</div>
            <div class="amigo-info">
                <h3 class="amigo-nome">{{ amigo.nome }}</h3>
                <p class="amigo-email"><i class="fas fa-envelope"></i> {{ amigo.email }}</p>
            </div>
        </div>

        <div class="segredo-alert">
            <i class="fas fa-shield-alt"></i>
            <div>
                <h4>ü§´ Mantenha o Segredo!</h4>
                <p>Esta informa√ß√£o √© apenas para voc√™. N√£o revele para ningu√©m quem voc√™ tirou!</p>
                <p class="text-small">Os outros participantes n√£o podem ver quem voc√™ sorteou.</p>
            </div>
        </div>
    </div>

    <!-- Sugest√µes do Amigo Sorteado -->
    <div class="card sugestoes-amigo">
        <div class="sugestoes-header">
            <h2><i class="fas fa-lightbulb"></i> Sugest√µes do {{ amigo.nome }}</h2>
            <p>Ideias do que presentear:</p>
        </div>

        {% if sugestoes_amigo %}
        <div class="sugestoes-list">
            {% for sugestao in sugestoes_amigo %}
            <div class="sugestao-item">
                <div class="sugestao-descricao">
                    <p>{{ sugestao.descricao }}</p>
                    {% if sugestao.link %}
                    <a href="{{ sugestao.link }}" target="_blank" class="sugestao-link">
                        <i class="fas fa-external-link-alt"></i> Ver link
                    </a>
                    {% endif %}
                </div>
                <small class="sugestao-date">Atualizada em {{ sugestao.updated_at.strftime('%d/%m/%Y') }}</small>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="sem-sugestoes">
            <i class="fas fa-gift"></i>
            <p>{{ amigo.nome }} ainda n√£o adicionou sugest√µes de presentes.</p>
            <p class="text-muted">Voc√™ pode dar uma dica sobre o que gostaria!</p>
        </div>
        {% endif %}

        <div class="sugestoes-actions">
            <a href="{{ url_for('lista_sugestoes', grupo_id=grupo.id) }}" class="btn btn-primary">
                <i class="fas fa-gifts"></i> Ver Todas as Sugest√µes
            </a>
        </div>
    </div>

    <!-- Informa√ß√µes do Evento -->
    <div class="card evento-info">
        <h2><i class="fas fa-calendar-alt"></i> Detalhes do Evento</h2>

        <div class="evento-grid">
            <div class="evento-item">
                <i class="fas fa-calendar"></i>
                <div>
                    <strong>Data</strong>
                    <p>{{ grupo.data_evento.strftime('%d/%m/%Y %H:%M') if grupo.data_evento else 'A definir' }}</p>
                </div>
            </div>

            <div class="evento-item">
                <i class="fas fa-map-marker-alt"></i>
                <div>
                    <strong>Local</strong>
                    <p>{{ grupo.local_evento or 'A definir' }}</p>
                </div>
            </div>

            <div class="evento-item">
                <i class="fas fa-money-bill-wave"></i>
                <div>
                    <strong>Valor Sugerido</strong>
                    <p>
                        {% if grupo.valor_minimo and grupo.valor_maximo %}
                            R$ {{ grupo.valor_minimo }} - R$ {{ grupo.valor_maximo }}
                        {% else %}
                            N√£o definido
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        {% if grupo.descricao %}
        <div class="evento-descricao">
            <h3><i class="fas fa-file-alt"></i> Sobre o Evento</h3>
            <p>{{ grupo.descricao }}</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.meu-sorteio-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
}

.meu-sorteio-header {
    text-align: center;
    margin-bottom: 30px;
}

.meu-sorteio-header .subtitle {
    color: #666;
    font-size: 1.2rem;
    margin: 10px 0 20px 0;
}

.header-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

/* Informa√ß√µes do Sorteio */
.sorteio-info {
    margin-bottom: 30px;
}

.info-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.badge-visualizacoes {
    background: #e3f2fd;
    color: #1976d2;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.info-content {
    display: grid;
    gap: 20px;
}

.info-item {
    display: flex;
    gap: 15px;
    align-items: center;
}

.info-item i {
    font-size: 1.5rem;
    color: var(--primary-color);
    min-width: 30px;
}

.link-container {
    display: flex;
    gap: 10px;
    margin-top: 5px;
}

.link-container input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-family: monospace;
    font-size: 0.9rem;
    color: #666;
}

.btn-copiar {
    background: #f8f9fa;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 10px 15px;
    cursor: pointer;
    color: #666;
    transition: all 0.3s;
}

.btn-copiar:hover {
    background: #e9ecef;
    color: #333;
}

/* Amigo Revelado */
.amigo-revelado {
    text-align: center;
    margin-bottom: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 40px;
}

.revelacao-header h2 {
    margin: 0 0 30px 0;
}

.amigo-detalhes {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 25px;
    margin: 30px 0;
}

.amigo-avatar-grande {
    width: 150px;
    height: 150px;
    background: white;
    color: #764ba2;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 4rem;
    font-weight: bold;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.amigo-info {
    text-align: center;
}

.amigo-nome {
    font-size: 3rem;
    margin: 0 0 10px 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.amigo-email {
    font-size: 1.2rem;
    opacity: 0.9;
}

.segredo-alert {
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    padding: 20px;
    margin-top: 30px;
    display: flex;
    gap: 20px;
    align-items: flex-start;
    text-align: left;
    backdrop-filter: blur(10px);
}

.segredo-alert i {
    font-size: 2rem;
    margin-top: 5px;
}

.segredo-alert h4 {
    margin: 0 0 10px 0;
    font-size: 1.3rem;
}

.segredo-alert p {
    margin: 0;
    line-height: 1.5;
}

.text-small {
    font-size: 0.9rem;
    opacity: 0.8;
}

/* Sugest√µes do Amigo */
.sugestoes-amigo {
    margin-bottom: 30px;
}

.sugestoes-header {
    text-align: center;
    margin-bottom: 30px;
}

.sugestoes-list {
    display: grid;
    gap: 15px;
    margin-bottom: 30px;
}

.sugestao-item {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    border-left: 4px solid var(--primary-color);
}

.sugestao-descricao p {
    margin: 0 0 10px 0;
    font-size: 1.1rem;
}

.sugestao-link {
    color: var(--primary-color);
    text-decoration: none;
}

.sugestao-link:hover {
    text-decoration: underline;
}

.sugestao-date {
    display: block;
    color: #666;
    margin-top: 10px;
    font-size: 0.9rem;
}

.sem-sugestoes {
    text-align: center;
    padding: 40px 20px;
    color: #666;
}

.sem-sugestoes i {
    font-size: 3rem;
    margin-bottom: 15px;
    color: #ddd;
}

.sugestoes-actions {
    text-align: center;
    margin-top: 30px;
}

/* Informa√ß√µes do Evento */
.evento-info {
    margin-bottom: 30px;
}

.evento-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.evento-item {
    display: flex;
    gap: 15px;
    align-items: center;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
}

.evento-item i {
    font-size: 1.5rem;
    color: var(--primary-color);
}

.evento-descricao {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 2px solid #eee;
}

.evento-descricao h3 {
    margin-bottom: 15px;
}

.evento-descricao p {
    line-height: 1.6;
    color: #555;
}
</style>

<script>
function copiarLink() {
    const input = document.getElementById('linkPerm');
    input.select();
    input.setSelectionRange(0, 99999); // Para dispositivos m√≥veis

    navigator.clipboard.writeText(input.value).then(() => {
        alert('Link copiado para a √°rea de transfer√™ncia!');
    }).catch(err => {
        // Fallback para navegadores antigos
        document.execCommand('copy');
        alert('Link copiado!');
    });
}

// Animar entrada
document.addEventListener('DOMContentLoaded', function() {
    const amigoAvatar = document.querySelector('.amigo-avatar-grande');
    const amigoNome = document.querySelector('.amigo-nome');

    setTimeout(() => {
        amigoAvatar.style.transform = 'scale(1.1)';
        amigoAvatar.style.transition = 'transform 0.5s ease';

        setTimeout(() => {
            amigoAvatar.style.transform = 'scale(1)';
        }, 500);
    }, 1000);

    // Efeito de digita√ß√£o no nome
    const nomeOriginal = amigoNome.textContent;
    amigoNome.textContent = '';
    let i = 0;

    function typeWriter() {
        if (i < nomeOriginal.length) {
            amigoNome.textContent += nomeOriginal.charAt(i);
            i++;
            setTimeout(typeWriter, 100);
        }
    }

    setTimeout(typeWriter, 1500);
});
</script>
{% endblock %}
